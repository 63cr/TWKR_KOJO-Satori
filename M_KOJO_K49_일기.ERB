[SKIPSTART]
;일기구상

;하루의 종료 시의 흐름
;@DIARY_TEXT_K49 (일기본문) → @DIARY_AFTER_CHECK_K49 (플래그의 처리)


;◆일기의 사양◆
;※１@DIARY_BEFORE_CHECK_K49로 일기 플래그가 선다.
;→ 미독플래그(2)가 서 있으면 하루의 끝에 데일리 이벤트로 일기가 읽힌다 (읽은것으로 된다).
;→ ※2미독플래그(3)가 서 있으면 [일기를 읽는다]로 읽을 수 있다。읽으면 읽음(1)이 된다.
;※1 각처 이벤트 구상이나 커맨드 구상에서 플래그를 세워도 좋습니다.
;※2 기본적으로 읽지 않음(2) 권장입니다. 읽음(1), 읽음(3)은 한 단계 필요.

;[일기를 읽는다]는, 소유자가 [연모]라면 자유롭게 읽을 수 있고,
;그렇지 않은 경우에는 연모가 아닌 인물이 그 자리에 없을 때, 혹은 시간정지함으로써 훔쳐 읽을 수 있다.
;거점 주민이 아닌 캐릭터는 연모라면 자택(초대방)에서 읽을 수 있다.

;MAX_DIARY_PAGE:49:0　캐릭터 번호 49의 일기 최대 페이지 수　한도는 101 (1~100)
;DIARY:49:YY　　　　　캐릭터 번호 49의 일기 번호 YY의 정보
;　　 3=미독　　　　　데일리 이벤트로 읽히지 않는다. [일기를 읽는다]로 읽으면 기독이 된다.
;　　 2=미독　　　　　데일리 이벤트로 읽힌다. 읽히기 전까지는 [일기를 읽는다]로는 읽을 수 없다. 읽히면 기독이 된다.
;　　 1=기독　　　　　데일리 이벤트로 읽히지 않는다. [일기를 읽는다]로 읽을 수 있다.
;　　 0=읽지못함　　　미해금.
;PAGESET:49:YY　　　　캐릭터 번호 49의 실제로 쓰여진 YY페이지째의 일기 번호.
;=============================
@DIARY_K49_EXIST
;존재판정
;0이면 일기는 쓸 수 없다.
;=============================
RETURN 1

;=============================
@DIARY_AFTER_CHECK_K49
;데일리 이벤트에서 일기가 읽혔을 때의 뒷처리.
;플래그 관리 등 자유롭게 취급해도 좋다.

;조건 플래그 리셋이나 판정 추가도 여기에 
;예를들어: 今日構ったフラグ
;今日構った일기가 표시된 후, 構ったフラグ를 리셋.
; CFLAG:49:今日構ったフラグ = 0
;혹은 어떠한 상태가 계속되는 것의 플래그인 경우
;예: 호감도가 거의 변하지 않는 날이 이어지면
;「아나타」의 태도가 차갑구나~ 같은 일기를 쓴다
; SIF CFLAG:49:호감도 <= LAST_LP+3
;   NOTOUCH_DAY ++
;=============================


;=============================
@DIARY_BEFORE_CHECK_K49
;상시 체크되는 일기의 상태 정보.
;여기서 DIARY:49:YY의 갱신을 실시한다.
;※DIARY:49:0번은 사용할 수 없다.

;여기서 범용 발생 조건을 기입한다
;커맨드별 발생 조건은 M_KOJO의 각 파일 안에서 추가해 주세요.

;기본적으로 발생조건에는 "DIARY:49:YY == 0"를 기입할 것.
;그렇지 않으면 같은 일기가 쓰여지거나 해 버린다.

;DIARY:49:YY　　　　캐릭터 번호 49의 일기 번호 YY의 정보
;　　 3=미독　　　　데일리 이벤트로 읽히지 않는다. [일기를 읽는다]로 읽으면 기독이 된다.
;　　 2=미독　　　　데일리 이벤트로 읽힌다. 읽히기 전까지는 [일기를 읽는다]로는 읽을 수 없다. 읽히면 기독이 된다.
;　　 1=기독　　　　데일리 이벤트로 읽히지 않는다. [일기를 읽는다]로 읽을 수 있다.
;　　 0=읽지못함　　미해금.

;○미독(2)로 하는 경우 (기본)
;미독(2)로 하면 데일리 이벤트로 발생, 하루의 끝에 하나만 읽힌다.
;여러 페이지가 미독(2)인 경우에는 번호가 작은 것이 읽히고, 그 이외는 리셋(0)된다.
;그래서, 여러 개가 동시에 발생하면, 발생했는데도 읽히지 않고 리셋 되는 경우도 있다.
;미독(2)로 하려면 단순히 플래그에 2를 넣기만 하면 된다.

;예1) 첫대면
;SIF DIARY:49:YY == 0 && CFLAG:49:안면
;	DIARY:49:YY = 2

;○미독(3)으로 하는 경우 (응용)
;미독(3)으로 하면 데일리 이벤트로써 읽히지 않고, 쓰여진 시점에서[일기를 읽는다]에 의해서 읽을 수 있게 된다.
;플레이어가 자주적으로 읽지 않는 한 읽히지 않고, 하루에 여러 페이지 가필되는 경우도 있다.
;미독(3)으로 하려면 플래그에 3을 넣은 다음、CALL CHARA_DIARY_PAGESETTING(49, YY)를 할 필요가 있다.

;예2) 호감도 100 이상
;IF DIARY:49:YY == 0 && CFLAG:49:호감도 >= 100
;	DIARY:49:YY = 3
;	CALL CHARA_DIARY_PAGESETTING(49, YY)
;ENDIF

;예3) 예2의 일기가 읽힌 후에 호감도 1000이상
;이것을 하면 YY를 읽은 직후 ZZ가 올라오는 일도 벌어진다.
;IF DIARY:49:ZZ == 0 && DIARY:49:YY == 1 && CFLAG:49:호감도 >= 1000
;	DIARY:49:ZZ = 3
;	CALL CHARA_DIARY_PAGESETTING(49, ZZ)
;ENDIF

;▽쓸데없는 참견의 주석
;첫키스는 기본적으로 다 [키스미경험]을 소지하고 있으므로, "!TALENT:49:키스미경험"으로 판정할 수 있습니다。
;데이트에서 돌아올때 키스로 분기하고 싶다면 데이트에서 돌아올때 키스 구상에서 플래그를 세웁시다.
;이 경우, 일반적인 첫키스 상실과 중복되지 않도록 주의합시다.
;처녀상실은 초기설정에서 처녀상실인 경우도 있으므로, 처녀상실 구상쪽에서 플래그를 세우는 것이 좋습니다.
;그 외 고백, 함락 등의 이벤트는 각종 이벤트 구상에서 플래그를 세웁시다. 첫대면은 그쪽도 괜찮아요.
;날짜를 정확히 세려면 별도의 플래그가 필요. 예를 들면 처음 만난 날이라든지.
;=============================
;MAXPAGE는 여기에 기입한다
MAX_DIARY_PAGE:49:0 = 1

;=============================
@DIARY_TEXT_K49, PAGENUM, MODE, PAGECOUNT
;일기의 내용
;PAGENUM   = 일기 번호 (일기의 패턴)
;MODE      = "デイリー":하루 종료시 데일리 이벤트에서 읽힘
;          = "コマンド":[일기를 읽는다] 커맨드로 읽힘
;PAGECOUNT = 몇 페이지째에 쓰여 있는가
;=============================
#DIM PAGENUM
#DIMS MODE
#DIM PAGECOUNT

;구상색 지정이 있으면 주석처리를 지운다
;CALL M_KOJO_COLOR_K49

;GROUPMATCH에 일기 ID를 넣어, 표시하고 싶은 얼굴 화상을 표시한다
;표정・복장・특수 화상을 옵션 지정으로 표시 (생략 가능)
;서식은 resources\顔.CSV와 아래 예시를 참조

;이하는 샘플
IF MODE == "デイリー"
	IF GROUPMATCH(PAGENUM, 1) 
		CALL PRINT_FACE, 49, "発情", "裸", "_1"
	ELSEIF GROUPMATCH(PAGENUM, 2)
		CALL PRINT_FACE, 49, "笑顔", "服1"
	ELSEIF GROUPMATCH(PAGENUM, 3)
		CALL PRINT_FACE, 49, "怒り"
	ELSE
		CALL PRINT_FACE, 49
	ENDIF
ENDIF

PRINTFORMDL - %CALLNAME:49%の日記　PAGE.{PAGECOUNT} --------------------------------------------------------------------------------------
PRINTL

;※PAGENUM:0은 사용할 수 없다
SELECTCASE PAGENUM
	CASE 1
		PRINTFORML ○月×日
		PRINTFORML 今日から、日記をつける事にした。
ENDSELECT

RESETCOLOR

;=============================
@M_KOJO_MESSAGE_COM_K49_406
;=============================
CALL TRAIN_MESSAGE
CALL M_KOJO_MESSAGE_COM_K49_406_1
RETURN RESULT

;=============================
@M_KOJO_MESSAGE_COM_K49_406_1
;커맨드 구상
;TFLAG:194 (누구의 일기를 읽고있는지)
;TFLAG:194가 49가 아닌 경우는 타인의 일기이므로 주의.
;PAGE는 적혀있는 페이지 수.
;SHIRAHU(49)는 캐릭터 49의 상태가 정상인지 아닌지.
;=============================
#DIM PAGE

;이하는 샘플
PAGE = 0
FOR LOCAL, 0, MAX_DIARY_PAGE:(TFLAG:194):0
	IF GROUPMATCH(DIARY:(TFLAG:194):LOCAL, 1, 3)
		PAGE ++
	ENDIF
NEXT

IF SHIRAHU(49) && TFLAG:194 == 49
;일기를 다 읽고 난 후의 반응
	IF PAGE > 2
		CALL SPTALK, 49,"通常",0,@"「日記を見せるって…なんだか恥ずかしいな…」//%CALLNAME:49%はまじまじとこちらを見つめている"
		;화상포함 토크는 최대 6행까지.
	ELSE
		PRINTFORML 
	ENDIF
ENDIF
[SKIPEND]